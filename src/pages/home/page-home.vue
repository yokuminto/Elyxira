<template>
  <div class="page-home">
    <!-- è£…é¥°å…ƒç´  -->
    <div class="page-home__decorations">
      <div class="page-home__decoration page-home__decoration--1">âœ¨</div>
      <div class="page-home__decoration page-home__decoration--2">âœ¨</div>
    </div>

    <!-- å¯¼èˆªæ  -->
    <header class="page-home__navbar">
      <!-- å·¦ä¾§ Logo æ–‡å­— -->
      <div class="page-home__navbar-title">
        <RouterLink to="/">
          <span class="page-home__navbar-logo-text">Elyxira</span>
        </RouterLink>
      </div>

      <!-- ä¸­é—´æœç´¢æ¡† -->
      <div class="page-home__navbar-search">
        <svg class="page-home__navbar-search-icon" viewBox="0 0 24 24" width="16" height="16">
          <path fill="currentColor"
            d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z">
          </path>
        </svg>
        <input type="text" class="page-home__navbar-search-input" placeholder="æœç´¢">
        <div class="page-home__navbar-search-shortcut">Ctrl K</div>
      </div>

      <!-- å³ä¾§èœå• -->
      <div class="page-home__navbar-menu">
        <RouterLink v-for="item in navItems" :key="item.text" :to="item.link" class="page-home__navbar-menu-item">
          {{ item.text }}
        </RouterLink>
        <div class="page-home__navbar-theme-toggle" @click="toggleTheme">
          <i class="sun-icon fas fa-sun"></i>
          <i class="moon-icon fas fa-moon"></i>
        </div>
        <a href="https://github.com/yokuminto/elyxira" target="_blank" class="page-home__navbar-github-icon">
          <svg viewBox="0 0 24 24" width="22" height="22">
            <path fill="currentColor"
              d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0012 2z">
            </path>
          </svg>
        </a>
      </div>
    </header>

    <div class="page-home__container">
      <!-- LogoåŒºåŸŸ -->
      <div class="page-home__logo">
        <h1 class="page-home__logo-text" data-text="Elyxira">Elyxira
          <div class="page-home__version">v0.1.0</div>
        </h1>
        <p class="page-home__tagline">å¼€æºå­¦ä¹ ä¸çŸ¥è¯†ç®¡ç†å¹³å°ï¼ŒåŠ©åŠ›ä¸´åºŠæŠ€èƒ½æå‡ä¸åŒ»è€ƒå¤‡è€ƒ</p>
      </div>

      <!-- åº”ç”¨å±•ç¤ºåŒºåŸŸ -->
      <div class="page-home__showcase">
        <div class="page-home__showcase-item" v-for="(image, index) in showcaseImages" :key="index">
          <img :src="image.src" :alt="image.alt" />
        </div>
      </div>

      <!-- æŒ‰é’®åŒºåŸŸ -->
      <div class="page-home__actions">
        <RouterLink to="/library" class="page-home__button page-home__button--library">æµè§ˆé¢˜åº“</RouterLink>
        <RouterLink to="/notes" class="page-home__button page-home__button--notes">æŸ¥çœ‹ç¬”è®°</RouterLink>
      </div>

      <!-- æ ¸å¿ƒåŠŸèƒ½åŒºåŸŸ -->
      <h2 class="page-home__section-title">æ ¸å¿ƒåŠŸèƒ½</h2>
      <div class="page-home__features">
        <div class="page-home__feature" v-for="(feature, index) in features" :key="index">
          <div class="page-home__feature-icon">{{ feature.icon }}</div>
          <h3 class="page-home__feature-title">{{ feature.title }}</h3>
          <p class="page-home__feature-description">{{ feature.description }}</p>
        </div>
      </div>

      <!-- å…³äºåŒºåŸŸ -->
      <h2 class="page-home__section-title">å…³äº Elyxira</h2>
      <div class="page-home__about">
        <div class="page-home__about-content">
          <p>Elyxira æ˜¯ä¸€ä¸ªä¸“ä¸ºè‡ªå­¦è€…ã€å­¦ç”Ÿå’Œæ•™è‚²å·¥ä½œè€…è®¾è®¡çš„å¼€æºå­¦ä¹ å¹³å°ï¼Œç›®çš„æ˜¯æä¾›ä¸€ä¸ªç®€å•æ˜“ç”¨çš„å·¥å…·ï¼Œå¸®åŠ©äººä»¬æ›´é«˜æ•ˆåœ°å­¦ä¹ å’Œå¤ä¹ ã€‚</p>
          <p>ä¸åŒäºä¼ ç»Ÿçš„å­¦ä¹ è½¯ä»¶ï¼ŒElyxira æ³¨é‡éšç§ä¿æŠ¤å’Œæ•°æ®æ§åˆ¶ï¼Œä½ å¯ä»¥é€‰æ‹©å°†æ•°æ®ä¿å­˜åœ¨æœ¬åœ°ï¼Œæˆ–è€…åŒæ­¥åˆ°è‡ªå·±çš„GitHubä»“åº“ï¼Œè€Œä¸æ˜¯ä¾èµ–ä¸­å¿ƒåŒ–æœåŠ¡å™¨ã€‚</p>
          <p>è¯¥é¡¹ç›®ç§‰æ‰¿å¼€æºç²¾ç¥ï¼Œæ¬¢è¿æ‰€æœ‰äººå‚ä¸è´¡çŒ®ï¼Œä¸€èµ·æ‰“é€ æ›´å¥½çš„å­¦ä¹ ä½“éªŒã€‚</p>
        </div>
        <div class="page-home__github">
          <a href="https://github.com/yokuminto/elyxira" target="_blank" rel="noopener noreferrer"
            class="page-home__github-link">
            <i class="fab fa-github"></i>
            GitHub é¡¹ç›®
          </a>
          <div class="page-home__github-stats">
            <div class="page-home__stat">
              <span class="page-home__stat-value">MIT</span>
              <span class="page-home__stat-label">å¼€æºåè®®</span>
            </div>
            <div class="page-home__stat">
              <span class="page-home__stat-value">Vue 3</span>
              <span class="page-home__stat-label">æŠ€æœ¯æ ˆ</span>
            </div>
            <div class="page-home__stat">
              <span class="page-home__stat-value">TypeScript</span>
              <span class="page-home__stat-label">å¼€å‘è¯­è¨€</span>
            </div>
          </div>
        </div>
      </div>

      <!-- å“ç‰Œæ”¯æŒåŒºåŸŸ -->
      <h2 class="page-home__section-title">æ„Ÿè°¢æ”¯æŒ</h2>
      <div class="page-home__brand">
        <a href="https://thfmu.com/" target="_blank" rel="noopener noreferrer" title="ä¸œæ–¹åŒ»å­¦">
          <img :src="themedLogo" width="180" alt="THMED" class="page-home__brand-logo" />
        </a>
        <p class="page-home__brand-text">æ¬¢è¿æ¥åˆ°ä¸œæ–¹åŒ»å­¦(THMED)ï¼</p>
        <p class="page-home__brand-description" v-html="brandDescription"></p>
      </div>
    </div>
    <!-- ç®€æ´é¡µè„šç»„ä»¶ -->
    <footer class="page-home__footer">
      <div class="page-home__footer-container">
        <div class="page-home__footer-columns">
          <!-- å­¦ä¹  -->
          <div class="page-home__footer-column">
            <h3 class="page-home__footer-title">å­¦ä¹ </h3>
            <div class="page-home__footer-links">
              <RouterLink to="/library" class="page-home__footer-link">é¢˜åº“ Â»</RouterLink>
              <RouterLink to="/notes" class="page-home__footer-link">ç¬”è®° Â»</RouterLink>
            </div>
          </div>

          <!-- å·¥å…· -->
          <div class="page-home__footer-column">
            <h3 class="page-home__footer-title">å·¥å…·</h3>
            <div class="page-home__footer-links">
              <RouterLink to="/ai-assistant" class="page-home__footer-link">é¢˜åº“å½•å…¥ï¼ˆæœªå®Œå·¥ï¼‰ Â»</RouterLink>
              <RouterLink to="/flashcards" class="page-home__footer-link">è‡ªåŠ¨çº é”™ï¼ˆæœªå®Œå·¥ï¼‰ Â»</RouterLink>
            </div>
          </div>

          <!-- ç¤¾åŒº -->
          <div class="page-home__footer-column">
            <h3 class="page-home__footer-title">ç¤¾åŒº</h3>
            <div class="page-home__footer-links">
              <a href="https://github.com/yokuminto/elyxira" target="_blank" rel="noopener noreferrer"
                class="page-home__footer-link">GitHub Â»</a>
              <RouterLink to="/about" class="page-home__footer-link">å…³äºæˆ‘ä»¬ Â»</RouterLink>
            </div>
          </div>
        </div>

        <!-- ç‰ˆæƒä¿¡æ¯ -->
        <div class="page-home__footer-copyright">
          &copy; 2025 Elyxira. All Rights Reserved.
        </div>
      </div>
    </footer>
  </div>
</template>

<script setup lang="ts">
import { RouterLink } from 'vue-router'
import { onMounted, ref, computed } from 'vue'
// å¯¼å…¥showToastå‡½æ•°
import { showToast } from '../../utils/toast'

// Toastæµ‹è¯•å‡½æ•°
const showInfoToast = () => {
  showToast('è¿™æ˜¯ä¸€æ¡ä¿¡æ¯æç¤º', 'info', 3000)
}

const showSuccessToast = () => {
  showToast('æ“ä½œæˆåŠŸå®Œæˆï¼', 'success', 3000)
}

const showWarningToast = () => {
  showToast('è¯·æ³¨æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªè­¦å‘Šæç¤º', 'warning', 3000)
}

const showErrorToast = () => {
  showToast('å‡ºé”™äº†ï¼Œè¯·é‡è¯•', 'error', 3000)
}

const showMultipleToasts = () => {
  // è¿ç»­æ˜¾ç¤ºå¤šä¸ªä¸åŒç±»å‹çš„Toast
  showToast('ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼šä¿¡æ¯æç¤º', 'info', 3000)
  setTimeout(() => showToast('ç¬¬äºŒæ¡æ¶ˆæ¯ï¼šæˆåŠŸæç¤º', 'success', 3000), 500)
  setTimeout(() => showToast('ç¬¬ä¸‰æ¡æ¶ˆæ¯ï¼šè­¦å‘Šæç¤º', 'warning', 3000), 1000)
  setTimeout(() => showToast('ç¬¬å››æ¡æ¶ˆæ¯ï¼šé”™è¯¯æç¤º', 'error', 3000), 1500)
}

// Define the toggleTheme function
const toggleTheme = () => {
  const themeToggle = document.querySelector('.page-home__navbar-theme-toggle') as HTMLElement
  if (themeToggle) {
    themeToggle.classList.toggle('dark')
    const isDark = themeToggle.classList.contains('dark')

    if (isDark) {
      document.body.classList.add('dark-theme')
      localStorage.setItem('theme', 'dark')
    } else {
      document.body.classList.remove('dark-theme')
      localStorage.setItem('theme', 'light')
    }

    // åŒæ­¥æ‰€æœ‰ä¸»é¢˜çŠ¶æ€
    syncThemeState()
  }
}

// åŒæ­¥ä¸»é¢˜çŠ¶æ€çš„å‡½æ•°
const syncThemeState = () => {
  const isDark = document.body.classList.contains('dark-theme')
  isDarkTheme.value = isDark

  // æ›´æ–°å¯¼èˆªæ æ ·å¼
  const navbar = document.querySelector('.page-home__navbar') as HTMLElement
  if (navbar) {
    if (isDark) {
      navbar.classList.add('dark')
    } else {
      navbar.classList.remove('dark')
    }

    // å¦‚æœå·²ç»æ»šåŠ¨ï¼Œä¿æŒscrolledç±»
    if (window.scrollY > 10) {
      navbar.classList.add('page-home__navbar--scrolled')
    }
  }
}

// æ·»åŠ logoè®¡ç®—å±æ€§
const isDarkTheme = ref(false)
const themedLogo = computed(() => {
  // ç›´æ¥è¿”å› public ç›®å½•ä¸‹çš„è·¯å¾„
  return isDarkTheme.value
    ? '/images/thmed-white.png'
    : '/images/thmed-red.png'
})

const brandDescription = 'ä¸œæ–¹åŒ»å­¦è‡´åŠ›äºåŒ»å­¦ç—…æ¡ˆäº¤æµã€å¾ªè¯ä½“ç³»å»ºæ„ä¸æ–‡åŒ–ä¼ æ’­<br />æä¾›ä¸œæ–¹ä¸–ç•Œè§‚ä½œå“ä¸åŒ»å­¦ä¸“ä¸šè¯¾çš„äº¤æµå¹³å°<br />æˆ‘ä»¬å¸Œæœ›æ‚¨åœ¨è¿™é‡Œåº¦è¿‡ä¸€æ®µç¾å¥½çš„æ—¶å…‰ï½'

// å¯¼èˆªæ èœå•é¡¹
const navItems = ref([
  { text: 'é¦–é¡µ', link: '/' },
  { text: 'é¢˜åº“', link: '/library' },
  { text: 'ç¬”è®°', link: '/notes' },
  { text: 'å…³äº', link: '/about' }
])

const showcaseImages = ref([
  {
    src: '/images/screenshot1.png', // æ›´æ–°è·¯å¾„
    alt: 'Elyxira åŒ»å­¦é¢˜åº“æˆªå›¾'
  },
  {
    src: '/images/screenshot2.png', // æ›´æ–°è·¯å¾„
    alt: 'Elyxira AIåˆ†ææˆªå›¾'
  }
])

const features = ref([
  {
    icon: 'ğŸ“š',
    title: 'é¢˜åº“ç³»ç»Ÿ',
    description: 'æ”¯æŒå¤šç§é¢˜å‹ï¼Œå¯å¯¼å…¥ã€å¯¼å‡ºé¢˜åº“ï¼Œéšæœºç»ƒä¹ ã€é¡ºåºç»ƒä¹ ã€é”™é¢˜é‡åšç­‰æ¨¡å¼'
  },
  {
    icon: 'ğŸ§ ',
    title: 'ç¬”è®°æœ¬',
    description: 'è®°å½•å­¦ä¹ ç¬”è®°ï¼Œæ”¯æŒåŸºæœ¬çš„æ–‡æœ¬æ ¼å¼ï¼Œå¿«é€ŸæŸ¥æ‰¾ï¼Œåˆ†ç±»æ•´ç†ï¼Œéšæ—¶éšåœ°å¤ä¹ '
  },
  {
    icon: 'ğŸ’‰',
    title: 'å¤šç«¯åŒæ­¥',
    description: 'æ”¯æŒæœ¬åœ°å­˜å‚¨ï¼Œåœ¨çº¿Githubä»“åº“åŒæ­¥ï¼Œå¤šè®¾å¤‡è®¿é—®ï¼Œæ•°æ®å®‰å…¨å¤‡ä»½æ— å¿§'
  },
  {
    icon: 'ğŸ¤–',
    title: 'AIåŠ©æ‰‹',
    description: 'é›†æˆAIåŠŸèƒ½ï¼Œè‡ªåŠ¨ç”Ÿæˆå­¦ä¹ ç¬”è®°ï¼Œæ™ºèƒ½åˆ†æé¢˜ç›®ï¼Œæä¾›ä¸ªæ€§åŒ–å­¦ä¹ å»ºè®®'
  }
])

// å¢å¼ºè¿‡æ¸¡æ•ˆæœ
onMounted(() => {
  // é¡µé¢æ·¡å…¥æ•ˆæœ
  document.body.style.opacity = '0'
  document.body.style.transition = 'opacity 0.8s ease'
  setTimeout(() => {
    document.body.style.opacity = '1'
  }, 100)

  // åˆå§‹åŒ–ä¸»é¢˜
  const savedTheme = localStorage.getItem('theme')
  if (savedTheme === 'dark') {
    isDarkTheme.value = true
    const themeToggle = document.querySelector('.page-home__navbar-theme-toggle') as HTMLElement
    if (themeToggle) {
      themeToggle.classList.add('dark')
      document.body.classList.add('dark-theme')
      // ç¡®ä¿å¯¼èˆªæ ä¹Ÿæ·»åŠ darkç±»
      const navbar = document.querySelector('.page-home__navbar') as HTMLElement
      if (navbar) {
        navbar.classList.add('dark')
      }
    }
  }

  // åˆå§‹åŒ–ååŒæ­¥æ‰€æœ‰ä¸»é¢˜çŠ¶æ€
  syncThemeState()

  // å¯¼èˆªæ æ»šåŠ¨æ•ˆæœ
  const navbar = document.querySelector('.page-home__navbar') as HTMLElement
  let lastScrollY = window.scrollY
  let ticking = false

  const handleScroll = () => {
    lastScrollY = window.scrollY

    if (!ticking) {
      window.requestAnimationFrame(() => {
        const isDark = document.body.classList.contains('dark-theme')

        if (lastScrollY > 10) {
          navbar.classList.add('page-home__navbar--scrolled')
          // ä¿æŒä¸å½“å‰ä¸»é¢˜ä¸€è‡´
          if (isDark) {
            navbar.classList.add('dark')
          }
        } else {
          navbar.classList.remove('page-home__navbar--scrolled')
          // æ ¹æ®ä¸»é¢˜å†³å®šæ˜¯å¦æœ‰darkç±»
          if (!isDark) {
            navbar.classList.remove('dark')
          }
        }

        ticking = false
      })

      ticking = true
    }
  }

  // åˆå§‹è¿è¡Œä¸€æ¬¡æ£€æŸ¥å½“å‰ä½ç½®
  handleScroll()

  // ç›‘å¬æ»šåŠ¨äº‹ä»¶
  window.addEventListener('scroll', handleScroll, { passive: true })

  // å¹³æ»‘æ»šåŠ¨æ•ˆæœ
  document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
    anchor.addEventListener('click', function (this: HTMLAnchorElement, e: Event) {
      e.preventDefault()
      const targetId = this.getAttribute('href')
      // æ£€æŸ¥ targetId æ˜¯å¦æœ‰æ•ˆä¸”ä¸åŒ…å«æ–œæ ï¼ˆå³ä¸æ˜¯è·¯ç”±é“¾æ¥ï¼‰
      if (!targetId || targetId === '#' || targetId.includes('/')) return

      try {
        const targetElement = document.querySelector(targetId)
        if (targetElement) {
          targetElement.scrollIntoView({ behavior: 'smooth' })
        }
      } catch (error) {
        // æ•è·æ— æ•ˆé€‰æ‹©å™¨é”™è¯¯ï¼Œä»¥é˜²ä¸‡ä¸€
        console.error(`å¹³æ»‘æ»šåŠ¨é”™è¯¯: æ— æ•ˆçš„é€‰æ‹©å™¨ '${targetId}'`, error)
      }
    })
  })

  // é¢„åŠ è½½å›¾ç‰‡å¹¶ç›´æ¥æ˜¾ç¤º
  document.querySelectorAll('.page-home__showcase-item img, .page-home__brand-logo').forEach((img) => {
    const imgElement = img as HTMLImageElement

    // æ£€æŸ¥å›¾ç‰‡åŠ è½½çŠ¶æ€
    if (imgElement.complete) {
      console.log('å›¾ç‰‡å·²åŠ è½½å®Œæˆ:', imgElement.src)
    } else {
      imgElement.onload = () => console.log('å›¾ç‰‡åŠ è½½æˆåŠŸ:', imgElement.src)
      imgElement.onerror = (e) => console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', imgElement.src, e)
    }
  })

  // æœç´¢æ¡†äº¤äº’
  const searchInput = document.querySelector('.page-home__navbar-search-input') as HTMLInputElement
  if (searchInput) {
    searchInput.addEventListener('focus', function () {
      this.placeholder = 'æœç´¢æ–‡æ¡£...'
    })
    searchInput.addEventListener('blur', function () {
      this.placeholder = 'æœç´¢'
    })
  }
})
</script>

<style>
@import './page-home.css';
@import '../../styles/variables.css';
/* ç§»é™¤CDNå¼•ç”¨ï¼Œæ”¹ç”¨linkæ ‡ç­¾æˆ–æœ¬åœ°èµ„æº */
</style>
